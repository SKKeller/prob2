

project.ext {

	targetRepositories = ["http://www.stups.uni-duesseldorf.de/prob_dev_target/","http://download.eclipse.org/releases/indigo/","http://rodin-b-sharp.sourceforge.net/updates"]	

	groupID = "de.prob2"

	excludeFromTychoBuild = ["de.prob.core.kernel"]
	excludeFromClassPath = ['de.prob.core.rodin', 'de.prob.ui', 'de.prob.ui.rodin', 'de.prob2.feature']
}

apply from: 'tycho_build.gradle'

task wrapper(type: Wrapper) {
    gradleVersion = '1.2'
}

project(':de.prob.core.rodin'){
	

	task switchToBuildMF()<<{
		def standardMF = new File(workspacePath+"${project.name}/META-INF/MANIFEST.MF")
		def buildMF = new File(workspacePath+"${project.name}/BUILD-META/MANIFEST.MF")
		standardMF.delete()
		standardMF << buildMF.text
	}
	
	task switchToStandardMF()<<{
		def standardMF = new File(workspacePath+"${project.name}/BUILD-META/OLD_MANIFEST.MF")
		def buildMF = new File(workspacePath+"${project.name}/META-INF/MANIFEST.MF")
		buildMF.delete()
		buildMF << standardMF.text
		
	}	
}

task deleteOldArtifacts(type: Delete) {
  	String updateSite = workspacePath+'updatesite'
	delete updateSite
}

task collectArtifacts(type:Copy) {
	    from workspacePath + groupID+'.repository/target/repository/'
	    into workspacePath + 'updatesite'
	    from workspacePath + "index.html"
	    into workspacePath + 'updatesite'
	    from workspacePath + "main.css"
	    into workspacePath + 'updatesite'
}

subprojects{
	apply plugin: 'eclipse'
	task magic(dependsOn: ['clean', 'cleanEclipse', 'eclipse', 'setClassPath']) {
	}
}